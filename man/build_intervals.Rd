% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cf_utils.R
\name{build_intervals}
\alias{build_intervals}
\title{Build conformal prediction intervals for difference between observed and counterfactual logcounts}
\usage{
build_intervals(
  test_data,
  qr_model,
  scores,
  weights_cal,
  w_test,
  alphas,
  gene,
  gene_names,
  tr_flag
)
}
\arguments{
\item{test_data}{A data frame of test cells (rows = cells, cols = covariates).}

\item{qr_model}{A quantile regression model fitted with conformalCQR.}

\item{scores}{Numeric matrix of conformal scores with dimension \verb{nrow(data_cal) x length(alphas)}.}

\item{weights_cal}{Numeric vector of calibration weights.}

\item{w_test}{Numeric vector of weights associated with the test samples.}

\item{alphas}{Numeric vector of miscoverage levels in (0,1).}

\item{gene}{Character string of the outcome gene.}

\item{gene_names}{Character vector of all gene names.}

\item{tr_flag}{Integer-vector flag (0 or 1) indicating treatment/control setting for each row of \code{test_data}}
}
\value{
A matrix with \code{nrow(test_data)*length(alphas)} with three columns ("lower","upper","cell_id","alpha").
}
\description{
Constructs prediction intervals for the difference between observed and
counterfactual logcounts using weighted split-CQR. Vectorized: accepts
multiple test rows at once.
}

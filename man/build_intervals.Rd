% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cf_utils.R
\name{build_intervals}
\alias{build_intervals}
\title{Build conformal prediction intervals for difference between observed and counterfactual logcounts}
\usage{
build_intervals(
  test_data,
  qr_model,
  other_scores,
  other_weights,
  w_x,
  alpha,
  gene,
  gene_names,
  tr_flag
)
}
\arguments{
\item{test_data}{A data frame of test cells (rows = cells, cols = covariates).}

\item{qr_model}{A quantile regression model fitted with conformalCQR.}

\item{other_scores}{Numeric vector of calibration scores.}

\item{other_weights}{Numeric vector of calibration weights.}

\item{w_x}{Numeric vector of weights associated with the test samples.}

\item{alpha}{Numeric scalar, miscoverage level in (0,1).}

\item{gene_names}{Character vector of all gene names.}

\item{tr_flag}{Integer-vector flag (0 or 1) indicating treatment/control setting for each row of \code{test_data}}

\item{gene_idx}{Column index of the outcome gene.}
}
\value{
A numeric matrix with two columns ("lower","upper"), one row per test cell.
}
\description{
Constructs prediction intervals for the difference between observed and
counterfactual logcounts using weighted split-CQR. Vectorized: accepts
multiple test rows at once.
}

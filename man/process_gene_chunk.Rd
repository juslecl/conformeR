% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cf_utils.R
\name{process_gene_chunk}
\alias{process_gene_chunk}
\title{Process a chunk of genes to compute conformal prediction intervals}
\usage{
process_gene_chunk(
  some_idxs,
  train_combined_df,
  cal_combined_df,
  test_g,
  gene_names,
  alphas,
  obs_condition,
  param3
)
}
\arguments{
\item{some_idxs}{Integer vector. Indices of the genes to process in this chunk.}

\item{train_combined_df}{A \code{data.frame}. Combined training set (treatment and control) for
propensity score modeling.}

\item{cal_combined_df}{A \code{data.frame}. Combined calibration set (treatment and control).}

\item{test_g}{A \code{data.frame} containing the test set for this group.}

\item{gene_names}{Character vector of all gene names in the dataset.}

\item{alphas}{Numeric vector of miscoverage levels for which conformal intervals
are computed.}

\item{obs_condition}{Character. Name of the column representing the observed condition
(treatment vs. control).}

\item{param3}{A \code{BiocParallelParam} object controlling parallelization across genes.}
}
\value{
A \code{data.frame} with conformal prediction intervals for all genes in the chunk.
The returned data.frame contains the following columns:
\itemize{
\item \code{lower} - Lower bound of the conformal interval
\item \code{upper} - Upper bound of the conformal interval
\item \code{alpha} - Miscoverage level corresponding to the interval
\item \code{gene} - Gene name
\item \code{covered} - Factor indicating whether 0 falls inside the interval ("inside"/"outside")
}
}
\description{
This internal helper function computes conformal prediction intervals for a subset of
genes (a "chunk") within a given conformal group. For each gene, it estimates
propensity scores, fits quantile regression models for treatment and control groups,
computes calibration scores, and constructs conformal prediction intervals across
multiple alphas.
}
\details{
For each gene in the chunk, the function:
\enumerate{
\item Fits a propensity score model using the combined training set.
\item Computes calibration weights for treatment and control samples.
\item Fits quantile regression models separately for treatment and control samples.
\item Computes calibration scores for all specified alphas.
\item Constructs conformal prediction intervals for all test cells, taking into account
their observed treatment/control condition.
}

Parallelization over genes is handled via \code{bplapply}. Computation within test sets
is vectorized to reduce memory usage.
}
\seealso{
\code{\link{process_group}}
}
